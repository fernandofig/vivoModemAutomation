#!/bin/sh

LOGIN_USER="support"
LOGIN_PASS="4a242bf6"

MDMHOST="http://192.168.15.1"
LOGINURL="/cgi-bin/login_advance.cgi"
REBOOTURL="/cgi-bin/reboot.cgi"
COOKIES="/root/data/mdmVivoCookies.txt"

echo -n "* Fazendo login no Modem... "
SIDPGLOGIN=`curl -s $MDMHOST$LOGINURL | grep "var sid" | awk -F "=" '{print $2}' | sed -r "s/['; \r\n]+//g"`
PASSHASH=`echo -n "$LOGIN_PASS:$SIDPGLOGIN" | md5sum | awk -F " " '{print $1}'`

LOGINPOSTDATA="Loginuser=$LOGIN_USER&fake_username=&fake_pass=&LoginPasswordValue=$PASSHASH&submitValue=1&Prestige_Login=Login&last_username0=&lastusername1=&status0=&status1="

rm -f $COOKIES
curl -s -c $COOKIES --data "$LOGINPOSTDATA" $MDMHOST$LOGINURL > /dev/null
echo "Ok!"

echo -n "* Enviando comando de reset ao Modem... "
curl -s -b $COOKIES --data "restoreFlag=1&RestartBtn=RESTART" $MDMHOST$REBOOTURL

echo "Ok!"

rm -f $COOKIES
